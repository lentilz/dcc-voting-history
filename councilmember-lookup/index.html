<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>DC Council Member Voting Records</title>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/foundation/6.3.1/css/foundation.css">
  <link rel="stylesheet" href="css/styles.css">
</head>
<body>
  <svg class="duotone-filters" xmlns="http://www.w3.org/2000/svg">
    <filter id="duotone_redblue">
        <feColorMatrix type="matrix" result="gray" values="1 0 0 0 0
                    1 0 0 0 0
                    1 0 0 0 0
                    0 0 0 1 0">
        </feColorMatrix>

        <feComponentTransfer color-interpolation-filters="sRGB" result="duotone">
            <feFuncR type="table" tableValues="0.00294117647058825 0.9372549019607843"></feFuncR>
            <feFuncG type="table" tableValues="0.11372549019607843 0.19215686274509805"></feFuncG>
            <feFuncB type="table" tableValues="0.403921568627451 0.1411764705882353"></feFuncB>
            <feFuncA type="table" tableValues="0 1"></feFuncA>
        </feComponentTransfer>
    </filter>
  </svg>

  <main class="row">
    <h1>DC Council Member Voting Record</h1>
    <ol>
      <li>Select Council Member
        <ul>
          <li>Dropdown will be populated with the council member in the current coucil period (22)</li>
          <li>Once selected, the council member's full name and title</li>
        </ul>
      </li>
      <li>Filter Results: number of results (could be a range selector to limit number of total results)</li>
      <li>Upon submission:
        <ul>
          <li>display results in a table below</li>
        </ul>
      </li>
    </ol>

    <section class="callout" style="background:url('http://images.metroscenes.com/images/2012/black-and-white-city-skylines/black_and_white_dc_metroscenes.com_01.jpg') no-repeat; background-size: cover; filter: url(#duotone_redblue);">
      <form class="js-vote-criteria">
        <label>Select a Councilmember
          <select>
            <!--  populated w Members API. the value should be set to the councilmember ID -->
            <option value="one">One</option>
            <option value="two">Two</option>
            <option value="three">Three</option>
          </select>
        </label>
        <label> Max results
          <input type="range" value="10">
        </label>
        <input type="submit" class="button" value="Submit">
      </form>
    </section>

    <table class="legislation-list">
      <thead>
        <tr class="row">
          <th class="small-12 large-2 column">Bill</th>
          <th class="small-12 large-9 column">Name</th>
          <th class="small-12 large-1 column">Vote</th>
        </tr>
      </thead>
      <tbody>

      </tbody>
    </table>
  </main>
  <script>
  var request = new XMLHttpRequest();

  request.open('POST', 'http://lims.dccouncil.us/api/v1/Voting/Search?rowLimit=0&offSet=0')
  // request.open('GET', 'http://lims.dccouncil.us/api/v1/masters/Members/0');
  // request.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded')
  request.setRequestHeader('Content-Type', 'application/json')
  request.withCredentials = false;
  var data = {
    "CouncilPeriod": "22",
    // "VoteType": "Voice Vote",
    // "VoteResult": "Approved",
    // "VoteResponse": "1",
    "CouncilMember": "248", //Pass in Council Member ID
  }
  request.send( JSON.stringify( data ) )

  request.onreadystatechange = function() {
    // Add a js-loading class
    if ( request.readyState === 4 && request.status === 200 ) {
      // remove loading class to reveal results

      // console.log( request.response );
      var votingRecord = JSON.parse( request.response ),
          table = document.querySelector('.legislation-list tbody'),
          legislationNumCol = document.createElement('td'),
          legislationTitleCol = document.createElement('td'),
          voteCol = document.createElement('td');

      legislationNumCol.setAttribute("class", "small-12 large-2 column");
      legislationTitleCol.setAttribute("class", "small-12 large-9 column");
      voteCol.setAttribute("class", "small-12 large-1 column");

      console.log( votingRecord.length );
      // Loop through the search results and output the relevant fields into a table
      for (var i=0; i< votingRecord.length; i++) {
        // Create a new table row and append td values
        // to cloned table columns/cells
        var row = document.createElement('tr'),
            number = legislationNumCol.cloneNode(true),
            title = legislationTitleCol.cloneNode(true),
            vote = voteCol.cloneNode(true);

        // Todo: wrap legislation number w link to the votingRecord[i].DocumentUrl
        number.append(votingRecord[i].LegislationNumber);
        title.append( votingRecord[i].Title );
        vote.append( votingRecord[i].MemberVotes[0].Result );
        // Add column for video to link to the hearing recording: votingRecord[i].VideoLink

        row.append( number, title, vote);

        table.append( row );
      }
    }

  }
  </script>
</body>
</html>
